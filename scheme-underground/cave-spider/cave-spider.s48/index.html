<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<html><head>
<meta http-equiv="content-type" content="text/html; charset=ISO-8859-1">

<!-- HTML file produced from file: manual.tex --
 -- using Hyperlatex v 2.3.1 (c) Otfried Cheong--
 -- on Emacs 20.4.1, Sun Jul 15 13:05:07 2001 -->

<title>Scheme 48 Manual -- Files and directories</title>

</head><body bgcolor="#ffffff">
<em>Scheme 48 Manual</em> | <a href="http://s48.org/0.57/manual/s48manual.html#top_node">Contents</a> | In Chapter: <a href="http://s48.org/0.57/manual/s48manual_65.html">Access to POSIX</a><br>Previous: <a href="http://s48.org/0.57/manual/s48manual_70.html">OS and machine identification</a> | Next: <a href="http://s48.org/0.57/manual/s48manual_72.html">Time</a>
<h2>Files and directories</h2>
<p>These procedures are in structures <code>posix-files</code> and <code>posix</code>.
</p><h3><a name="1">Directory streams</a></h3>
<p>Directory streams are like input ports, with each read operation
 returning the next name in the directory.
</p><ul><li><code>(open-directory-stream<i>&nbsp;name</i>)&nbsp;-&gt;&nbsp;<i>directory</i></code><a name="2">&nbsp;</a>
</li><li><code>(directory-stream?<i>&nbsp;x</i>)&nbsp;-&gt;&nbsp;<i>boolean</i></code><a name="3">&nbsp;</a>
</li><li><code>(read-directory-stream<i>&nbsp;directory</i>)&nbsp;-&gt;&nbsp;<i>name&nbsp;or&nbsp;<tt>&nbsp;#f</tt></i></code><a name="4">&nbsp;</a>
</li><li><code>(close-directory-stream<i>&nbsp;directory</i>)</code><a name="5">&nbsp;</a>
</li></ul>
<code>Open-directory-stream</code> opens a new directory stream.
<code>Directory-stream?</code> is a predicate that recognizes directory streams.
<code>Read-directory-stream</code> returns the next name in the directory or
 <code>#f</code> if all names have been read.
<code>Close-directory-stream</code> closes a directory stream.
<ul><li><code>(list-directory<i>&nbsp;name</i>)&nbsp;-&gt;&nbsp;<i>list&nbsp;of&nbsp;strings</i></code><a name="6">&nbsp;</a>
</li></ul>
This is the obvious utility; it returns a list of the names in directory
 <code><i>name</i></code>.
<h3><a name="7">Working directory</a></h3>
<ul><li><code>(working-directory<i></i>)&nbsp;-&gt;&nbsp;<i>string</i></code><a name="8">&nbsp;</a>
</li><li><code>(set-working-directory!<i>&nbsp;string</i>)</code><a name="9">&nbsp;</a>
</li></ul>
These return and set the working directory.
<h3><a name="10">File creation and removal</a></h3>
<ul><li><code>(open-file<i>&nbsp;path&nbsp;file-options</i>)&nbsp;-&gt;&nbsp;<i>port</i></code><a name="11">&nbsp;</a>
</li><li><code>(open-file<i>&nbsp;path&nbsp;file-options&nbsp;file-mode</i>)&nbsp;-&gt;&nbsp;<i>port</i></code><a name="12">&nbsp;</a>
</li></ul>
<code>Open-file</code> opens a port to the file named by string <code><i>path</i></code>.
The <code><i>file-options</i></code> argument determines various aspects of the 
 returned port.
The optional <code><i>file-mode</i></code> argument is used only if the file to be opened
 does not already exist.
The returned port is an input port if <code><i>file-options</i></code> includes
 <code>read-only</code>; otherwise it returns an output port.
<code>Dup-switching-mode</code> can be used to open an input port for
 output ports opened with the <code>read/write</code> option.
<ul><li><table width="80%" border="0" cellpadding="0" cellspacing="0">
<tbody><tr> <td><code>(file-options <code><i>file-option-name</i></code> ...)&nbsp;-&gt;&nbsp;<i>file-options</i></code></td> <td align="right">syntax</td></tr></tbody></table>
</li><li><code>(file-options-on?<i>&nbsp;file-options&nbsp;file-options</i>)&nbsp;-&gt;&nbsp;<i>boolean</i></code><a name="13">&nbsp;</a>
</li></ul>
The syntax <code>file-options</code> returns a file-option with the
 indicated options set.
<code>File-options-on?</code> returns true if its first argument includes all of
 the options listed in the second argument.
The following file options may be used with <code>open-file</code>.
<blockquote><center>
<table><tbody><tr><td colspan="1" align="LEFT">

 </td><td colspan="1" align="LEFT"> <code>create</code> </td><td colspan="1" align="LEFT"> create file if it does not already exist; a file-mode argument
 is required with this option </td></tr>
<tr><td colspan="1" align="LEFT">
</td><td colspan="1" align="LEFT"> <code>exclusive</code> </td><td colspan="1" align="LEFT"> an error will be raised if this option and <code>create</code>
 are both set and the file already exists </td></tr>
<tr><td colspan="1" align="LEFT">
</td><td colspan="1" align="LEFT"> <code>no-controlling-tty</code> </td><td colspan="1" align="LEFT"> if <code><i>path</i></code> is a terminal device this option
 causes the terminal to not become the controlling terminal of the process</td></tr>
<tr><td colspan="1" align="LEFT">
</td><td colspan="1" align="LEFT"> <code>truncate</code> </td><td colspan="1" align="LEFT"> file is truncated </td></tr>
<tr><td colspan="1" align="LEFT">
</td><td colspan="1" align="LEFT"> <code>append</code> </td><td colspan="1" align="LEFT"> writes are appended to existing contents </td></tr>
<tr><td colspan="1" align="LEFT">
</td><td colspan="1" align="LEFT"> <code>nonblocking</code> </td><td colspan="1" align="LEFT"> read and write operations do not block </td></tr>
<tr><td colspan="1" align="LEFT">
</td><td colspan="1" align="LEFT"> <code>read-only</code> </td><td colspan="1" align="LEFT"> port may not be written </td></tr>
<tr><td colspan="1" align="LEFT">
</td><td colspan="1" align="LEFT"> <code>read-write</code> </td><td colspan="1" align="LEFT"> file descriptor may be read or written </td></tr>
<tr><td colspan="1" align="LEFT">
</td><td colspan="1" align="LEFT"> <code>write-only</code> </td><td colspan="1" align="LEFT"> port may not be read
</td></tr></tbody></table>

</center></blockquote>
Only one of the last three options may be used.
<p>For example
</p><blockquote><pre>(open-file "some-file.txt"
           (file-options create write-only)
           (file-mode read owner-write))
</pre></blockquote>
returns an output port that writes to a newly-created file that can be
 read by anyone and written only by the owner.
Once the file exists,
<blockquote><pre>(open-file "some-file.txt"
           (file-options append write-only))
</pre></blockquote>
will open an output port that appends to the file.
<p>The <code>append</code> and <code>nonblocking</code> options and the read/write nature of
 the port can be read using <code>i/o-flags</code>.
The <code>append</code> and <code>nonblocking</code> options can be set
 using <code>set-i/o-flags!</code>.
</p><p>To keep port operations from blocking the Scheme&nbsp;48 process, output
 ports are set to be nonblocking at the time of creation (input ports
 are managed using <code>select()</code>).
You can use <code>set-i/o-flags!</code> to make an output port blocking, for
 example just before a fork, but care should be exercised.
The Scheme&nbsp;48 runtime code may get confused if an I/O operation blocks.
</p><ul><li><code>(set-file-creation-mask!<i>&nbsp;file-mode</i>)</code><a name="14">&nbsp;</a>
</li></ul>
Sets the file creation mask to be <code><i>file-mode</i></code>.
Bits set in <code><i>file-mode</i></code> are cleared in the modes of any files or
 directories created by the current process.
<ul><li><code>(link<i>&nbsp;existing&nbsp;new</i>)</code><a name="15">&nbsp;</a>
</li></ul>
<code>Link</code> makes path <code><i>new</i></code> be a new link to the file
 pointed to by path <code><i>existing</i></code>.
The two paths must be in the same file system.
<ul><li><code>(make-directory<i>&nbsp;name&nbsp;file-mode</i>)</code><a name="16">&nbsp;</a>
</li><li><code>(make-fifo<i>&nbsp;file-mode</i>)</code><a name="17">&nbsp;</a>
</li></ul>
These two procedures make new directories and fifo files.
<ul><li><code>(unlink<i>&nbsp;path</i>)</code><a name="18">&nbsp;</a>
</li><li><code>(remove-directory<i>&nbsp;path</i>)</code><a name="19">&nbsp;</a>
</li><li><code>(rename<i>&nbsp;old-path&nbsp;new-path</i>)</code><a name="20">&nbsp;</a>
</li></ul>
<code>Unlink</code> removes the link indicated by <code><i>path</i></code>.
<code>Remove-directory</code> removes the indicated (empty) directory.
<code>Rename</code> moves the file pointed to by <code><i>old-path</i></code> to the
 location pointed to by <code><i>new-path</i></code> (the two paths must be in
 the same file system).
Any other links to the file remain unchanged.
<ul><li><code>(accessible?<i>&nbsp;path&nbsp;access-mode&nbsp;.&nbsp;more-modes</i>)&nbsp;-&gt;&nbsp;<i>boolean</i></code><a name="21">&nbsp;</a>
</li><li><table width="80%" border="0" cellpadding="0" cellspacing="0">
<tbody><tr> <td><code>(access-mode <code><i>mode-name</i></code>)&nbsp;-&gt;&nbsp;<i>access-mode</i></code></td> <td align="right">syntax</td></tr></tbody></table>
</li></ul>
<code>Accessible?</code> returns true if <code><i>path</i></code> is a file that
 can be accessed in the listed mode.
If more than one mode is specified <code>accessible?</code> returns true
 if all of the specified modes are permitted.
The <code><i>mode-name</i></code>s are: <code>read</code>, <code>write</code>, <code>execute</code>,
 <code>exists</code>.
<h3><a name="22">File information</a></h3>
<ul><li><code>(get-file-info<i>&nbsp;name</i>)&nbsp;-&gt;&nbsp;<i>file-info</i></code><a name="23">&nbsp;</a>
</li><li><code>(get-file/link-info<i>&nbsp;name</i>)&nbsp;-&gt;&nbsp;<i>file-info</i></code><a name="24">&nbsp;</a>
</li><li><code>(get-port-info<i>&nbsp;fd-port</i>)&nbsp;-&gt;&nbsp;<i>file-info</i></code><a name="25">&nbsp;</a>
</li></ul>
<code>Get-file-info</code> and <code>get-file/link-info</code> both return
 a file info record for the named file.
<code>Get-file-info</code> follows symbolic links while <code>get-file/link-info</code>
 does not.
<code>Get-port-info</code> returns a file info record for the file
 which <code><i>port</i></code> reads from or writes to.
An error is raised if <code><i>fd-port</i></code> does not read from or write to a
 file descriptor.
<ul><li><code>(file-info?<i>&nbsp;x</i>)&nbsp;-&gt;&nbsp;<i>boolean</i></code><a name="26">&nbsp;</a>
</li><li><code>(file-info-name<i>&nbsp;file-info</i>)&nbsp;-&gt;&nbsp;<i>string</i></code><a name="27">&nbsp;</a>
</li></ul>
<code>File-info?</code> is a predicate for file-info records.
<code>File-info-name</code> is the name which was used to get <code>file-info</code>,
 either as passed to <code>get-file-info</code> or <code>get-file/link-info</code>,
 or used to open the port passed to <code>get-port-info</code>.
<ul><li><code>(file-info-type<i>&nbsp;file-info</i>)&nbsp;-&gt;&nbsp;<i>file-type</i></code><a name="28">&nbsp;</a>
</li><li><code>(file-type?<i>&nbsp;x</i>)&nbsp;-&gt;&nbsp;<i>boolean</i></code><a name="29">&nbsp;</a>
</li><li><code>(file-type-name<i>&nbsp;file-type</i>)&nbsp;-&gt;&nbsp;<i>symbol</i></code><a name="30">&nbsp;</a>
</li><li><table width="80%" border="0" cellpadding="0" cellspacing="0">
<tbody><tr> <td><code>(file-type <code><i>type</i></code>)&nbsp;-&gt;&nbsp;<i>file-type</i></code></td> <td align="right">syntax</td></tr></tbody></table>
</li></ul>
<code>File-info-type</code> returns the type of the file, as a file-type object
File types may be compared using <code>eq?</code>.
The valid file types are:
<blockquote><center>
<table><tbody><tr><td colspan="1" align="LEFT">

 <code>regular</code> </td></tr>
<tr><td colspan="1" align="LEFT">
<code>directory</code> </td></tr>
<tr><td colspan="1" align="LEFT">
<code>character-device</code> </td></tr>
<tr><td colspan="1" align="LEFT">
<code>block-device</code> </td></tr>
<tr><td colspan="1" align="LEFT">
<code>fifo</code> </td></tr>
<tr><td colspan="1" align="LEFT">
<code>symbolic-link</code> </td></tr>
<tr><td colspan="1" align="LEFT">
<code>socket</code> </td></tr>
<tr><td colspan="1" align="LEFT">
<code>other</code>
</td></tr></tbody></table>

</center></blockquote>
<p><code>Symbolic-link</code> and <code>socket</code> are not required by POSIX.
</p><ul><li><code>(file-info-device<i>&nbsp;file-info</i>)&nbsp;-&gt;&nbsp;<i>integer</i></code><a name="31">&nbsp;</a>
</li><li><code>(file-info-inode<i>&nbsp;file-info</i>)&nbsp;-&gt;&nbsp;<i>integer</i></code><a name="32">&nbsp;</a>
</li></ul>
The device and inode numbers uniquely determine a file.
<ul><li><code>(file-info-link-count<i>&nbsp;file-info</i>)&nbsp;-&gt;&nbsp;<i>integer</i></code><a name="33">&nbsp;</a>
</li><li><code>(file-info-size<i>&nbsp;file-info</i>)&nbsp;-&gt;&nbsp;<i>integer</i></code><a name="34">&nbsp;</a>
</li></ul>
These return the number of links to a file and the file size in bytes.
The size is only meaningful for regular files.
<ul><li><code>(file-info-owner<i>&nbsp;file-info</i>)&nbsp;-&gt;&nbsp;<i>user-id</i></code><a name="35">&nbsp;</a>
</li><li><code>(file-info-group<i>&nbsp;file-info</i>)&nbsp;-&gt;&nbsp;<i>group-id</i></code><a name="36">&nbsp;</a>
</li><li><code>(file-info-mode<i>&nbsp;file-info</i>)&nbsp;-&gt;&nbsp;<i>file-mode</i></code><a name="37">&nbsp;</a>
</li></ul>
These return the owner, group, and access mode of a file.
<ul><li><code>(file-info-last-access<i>&nbsp;file-info</i>)&nbsp;-&gt;&nbsp;<i>time</i></code><a name="38">&nbsp;</a>
</li><li><code>(file-info-last-modification<i>&nbsp;file-info</i>)&nbsp;-&gt;&nbsp;<i>time</i></code><a name="39">&nbsp;</a>
</li><li><code>(file-info-last-info-change<i>&nbsp;file-info</i>)&nbsp;-&gt;&nbsp;<i>time</i></code><a name="40">&nbsp;</a>
</li></ul>
These return the time the file was last read, modified, or had its
 status modified
<h3><a name="41">File modes</a></h3>
<p>A file mode is a boxed integer representing a file protection mask.
</p><ul><li><table width="80%" border="0" cellpadding="0" cellspacing="0">
<tbody><tr> <td><code>(file-mode permission-name ...)&nbsp;-&gt;&nbsp;<i>file-mode</i></code></td> <td align="right">syntax</td></tr></tbody></table>
</li><li><code>(file-mode?<i>&nbsp;x</i>)&nbsp;-&gt;&nbsp;<i>boolean</i></code><a name="42">&nbsp;</a>
</li><li><code>(file-mode+<i>&nbsp;file-mode&nbsp;...</i>)&nbsp;-&gt;&nbsp;<i>file-mode</i></code><a name="43">&nbsp;</a>
</li><li><code>(file-mode-<i>&nbsp;file-mode0&nbsp;file-mode1</i>)&nbsp;-&gt;&nbsp;<i>file-mode</i></code><a name="44">&nbsp;</a>
</li></ul>
<code>File-mode</code> is syntax for creating file modes.
The mode-names are listed below.
<code>File-mode?</code> is a predicate for file modes.
<code>File-mode+</code> returns a mode that contains all of permissions of
 its arguments.
<code>File-mode-</code> returns a mode that has all of the permissions of
 <code><i>file-mode0</i></code> that are not in <code><i>file-mode1</i></code>.
<ul><li><code>(file-mode=?<i>&nbsp;file-mode0&nbsp;file-mode1</i>)&nbsp;-&gt;&nbsp;<i>boolean</i></code><a name="45">&nbsp;</a>
</li><li><code>(file-mode&lt;=?<i>&nbsp;file-mode0&nbsp;file-mode1</i>)&nbsp;-&gt;&nbsp;<i>boolean</i></code><a name="46">&nbsp;</a>
</li><li><code>(file-mode&gt;=?<i>&nbsp;file-mode0&nbsp;file-mode1</i>)&nbsp;-&gt;&nbsp;<i>boolean</i></code><a name="47">&nbsp;</a>
</li></ul>
<code>File-mode=?</code> returns true if the two modes are exactly the same.
<code>File-mode&lt;=?</code> returns true if <code><i>file-mode0</i></code> has a subset
 of the permissions of <code><i>file-mode1</i></code>.
<code>File-mode&gt;=?</code> is <code>file-mode&lt;=?</code> with the arguments reversed.
<ul><li><code>(file-mode-&gt;integer<i>&nbsp;file-mode</i>)&nbsp;-&gt;&nbsp;<i>integer</i></code><a name="48">&nbsp;</a>
</li><li><code>(integer-&gt;file-mode<i>&nbsp;integer</i>)&nbsp;-&gt;&nbsp;<i>file-mode</i></code><a name="49">&nbsp;</a>
</li></ul>
<code>Integer-&gt;file-mode</code> and <code>file-mode-&gt;integer</code> translate file modes
 to and from the classic Unix file mode masks.
These may not be the masks used by the underlying OS.
<blockquote><center>
<table><tbody><tr><td colspan="1" align="LEFT">

Permission name </td><td colspan="1" align="LEFT"> Bit mask </td></tr>
<tr><td colspan="1" align="LEFT">
<code>set-uid</code> </td><td colspan="1" align="LEFT"> <code>#o4000</code> </td><td colspan="1" align="LEFT"> set user id when executing </td></tr>
<tr><td colspan="1" align="LEFT">
<code>set-gid</code> </td><td colspan="1" align="LEFT"> <code>#o2000</code> </td><td colspan="1" align="LEFT"> set group id when executing </td></tr>
<tr><td colspan="1" align="LEFT">
<code>owner-read</code> </td><td colspan="1" align="LEFT"> <code>#o0400</code> </td><td colspan="1" align="LEFT"> read by owner </td></tr>
<tr><td colspan="1" align="LEFT">
<code>owner-write</code> </td><td colspan="1" align="LEFT"> <code>#o0200</code> </td><td colspan="1" align="LEFT"> write by owner </td></tr>
<tr><td colspan="1" align="LEFT">
<code>owner-exec</code> </td><td colspan="1" align="LEFT"> <code>#o0100</code> </td><td colspan="1" align="LEFT"> execute (or search) by owner </td></tr>
<tr><td colspan="1" align="LEFT">
<code>group-read</code> </td><td colspan="1" align="LEFT"> <code>#o0040</code> </td><td colspan="1" align="LEFT"> read by group </td></tr>
<tr><td colspan="1" align="LEFT">
<code>group-write</code> </td><td colspan="1" align="LEFT"> <code>#o0020</code> </td><td colspan="1" align="LEFT"> write by group </td></tr>
<tr><td colspan="1" align="LEFT">
<code>group-exec</code> </td><td colspan="1" align="LEFT"> <code>#o0010</code> </td><td colspan="1" align="LEFT"> execute (or search) by group </td></tr>
<tr><td colspan="1" align="LEFT">
<code>other-read</code> </td><td colspan="1" align="LEFT"> <code>#o0004</code> </td><td colspan="1" align="LEFT"> read by others </td></tr>
<tr><td colspan="1" align="LEFT">
<code>other-write</code> </td><td colspan="1" align="LEFT"> <code>#o0002</code> </td><td colspan="1" align="LEFT"> write by others </td></tr>
<tr><td colspan="1" align="LEFT">
<code>other-exec</code> </td><td colspan="1" align="LEFT"> <code>#o0001</code> </td><td colspan="1" align="LEFT"> execute (or search) by others </td></tr>
<tr><td colspan="1" align="LEFT">
</td></tr></tbody></table>

</center></blockquote>
<blockquote><center>
<table><tbody><tr><td colspan="3" align="LEFT">

Names for sets of permissions </td></tr>
<tr><td colspan="1" align="LEFT">
<code>owner</code> </td><td colspan="1" align="LEFT"> <code>#o0700</code> </td><td colspan="1" align="LEFT"> read, write, and execute by owner </td></tr>
<tr><td colspan="1" align="LEFT">
<code>group</code> </td><td colspan="1" align="LEFT"> <code>#o0070</code> </td><td colspan="1" align="LEFT"> read, write, and execute by group </td></tr>
<tr><td colspan="1" align="LEFT">
<code>other</code> </td><td colspan="1" align="LEFT"> <code>#o0007</code> </td><td colspan="1" align="LEFT"> read, write, and execute by others </td></tr>
<tr><td colspan="1" align="LEFT">
<code>read</code> </td><td colspan="1" align="LEFT"> <code>#o0444</code> </td><td colspan="1" align="LEFT"> read by anyone </td></tr>
<tr><td colspan="1" align="LEFT">
<code>write</code> </td><td colspan="1" align="LEFT"> <code>#o0222</code> </td><td colspan="1" align="LEFT"> write by anyone </td></tr>
<tr><td colspan="1" align="LEFT">
<code>exec</code> </td><td colspan="1" align="LEFT"> <code>#o0111</code> </td><td colspan="1" align="LEFT"> execute by anyone </td></tr>
<tr><td colspan="1" align="LEFT">
<code>all</code> </td><td colspan="1" align="LEFT"> <code>#o0777</code> </td><td colspan="1" align="LEFT"> anything by anyone
</td></tr></tbody></table>

</center></blockquote>
<p>
  
Previous: <a href="http://s48.org/0.57/manual/s48manual_70.html">OS and machine identification</a> | Next: <a href="http://s48.org/0.57/manual/s48manual_72.html">Time</a></p></body></html>